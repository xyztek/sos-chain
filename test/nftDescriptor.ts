import { expect } from "chai";
import { ethers } from "hardhat";

describe("NFTDescriptor", function () {
  before(async function () {
    const svgFactory = await ethers.getContractFactory("SVG");
    const svg = await svgFactory.deploy();
    await svg.deployed();

    this.factory = await ethers.getContractFactory("NFTDescriptor", {
      libraries: {
        SVG: svg.address,
      },
    });
  });

  beforeEach(async function () {
    this.contract = await this.factory.deploy();
    await this.contract.deployed();
  });

  it("should construct SVG representation", async function () {
    const base64 = await this.contract._constructTokenURI(
      212321,
      ethers.constants.WeiPerEther.mul(1000),
      "0xEcdA812a67Ff9EB0257732D6a361008864275fCC",
      "Unicef",
      "War"
    );

    expect(base64).to.equal(
      "PHN2ZyB3aWR0aD0iMjkwIiBoZWlnaHQ9IjUwMCIgdmlld0JveD0iMCAwIDI5MCA1MDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHN0eWxlPjwhW0NEQVRBW3RleHR7Zm9udC1mYW1pbHk6SGVsdmV0aWNhO2ZvbnQtd2VpZ2h0OjEwMH0uYWxwaGF7b3BhY2l0eTowLjV9LnNtYWxse2ZvbnQtc2l6ZTouOHJlbX0ubGFyZ2V7Zm9udC1zaXplOjEuMnJlbX0udGl0bGV7ZmlsbDojZmZmfV1dPjwvc3R5bGU+PHBhdGggZmlsbD0iIzIyMjI1RSIgZD0iTTAgMGgyOTB2NTAwSDB6Ij48L3BhdGg+PHBhdGggZmlsbD0iI0ZGRiIgZD0iTTI3MCAxaDE5djQ5OGgtMTl6Ij48L3BhdGg+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTYgMTYpIj48cGF0aCBkPSJtNTIuNyAyNy41IDMuNi0yLjFjLjggMi4yIDIuNCAzLjMgNC45IDMuMyAyLjQgMCAzLjQtLjkgMy40LTIuMyAwLS43LS40LTEuNC0xLTEuNy0uNy0uNC0xLjktLjktMy42LTEuNC0xLjktLjYtMy4xLTEtNC40LTItMS4zLS45LTItMi40LTItNC40cy43LTMuNSAyLTQuNmMxLjQtMS4xIDMuMi0xLjggNS0xLjcgMy40IDAgNi4xIDEuOCA3LjYgNC44bC0zLjUgMmMtLjktMS44LTIuMi0yLjctNC4xLTIuNy0xLjcgMC0yLjguOS0yLjggMi4xIDAgLjcuMyAxLjMuOCAxLjYuNi40IDEuNi45IDMuMiAxLjNsMS41LjVjLjUuMi45LjMgMS40LjVzLjkuNCAxLjMuN2MuNy40IDEuNiAxLjEgMiAxLjkuNS45LjggMiAuOCAzIDAgMi0uNyAzLjUtMi4yIDQuNy0xLjQgMS4xLTMuMyAxLjctNS42IDEuNy00LjIgMC03LjEtMi04LjMtNS4yem0yOCA1LjJjLTYgLjEtMTEtNC43LTExLjEtMTAuOHYtLjNjLS4xLTIuOSAxLjEtNS44IDMuMi03LjggNC4zLTQuMyAxMS4zLTQuMyAxNS43IDAgMi4xIDIgMy4zIDQuOSAzLjIgNy44LjEgNi00LjggMTEtMTAuOCAxMS4xLS4xLjEtLjEuMS0uMiAwem0wLTQuMWMxLjguMSAzLjYtLjcgNC45LTJzMi0zLjEgMi01Yy4xLTEuOS0uNy0zLjctMi01LTIuNy0yLjYtNy4xLTIuNi05LjggMC0xLjMgMS4zLTIgMy4xLTIgNS0uMSAxLjkuNyAzLjcgMiA1IDEuMyAxLjQgMyAyLjEgNC45IDJ6bTExLjQtMS4xIDMuNi0yLjFjLjggMi4yIDIuNSAzLjMgNC45IDMuM3MzLjQtLjkgMy40LTIuM2MwLS43LS40LTEuNC0xLTEuNy0uNy0uNC0xLjktLjktMy42LTEuNC0xLjktLjYtMy4xLTEtNC40LTItMS4zLS45LTItMi40LTItNC40cy43LTMuNSAyLTQuNmMxLjQtMS4xIDMuMi0xLjggNS0xLjcgMy40IDAgNi4xIDEuOCA3LjYgNC44bC0zLjUgMmMtLjktMS44LTIuMi0yLjctNC4xLTIuNy0xLjcgMC0yLjguOS0yLjggMi4xIDAgLjcuMyAxLjMuOCAxLjYuNi40IDEuNi45IDMuMiAxLjNsMS41LjVjLjUuMi45LjMgMS40LjVzLjkuNCAxLjMuN2MuNy40IDEuNiAxLjEgMiAxLjkuNS45LjggMiAuOCAzIDAgMi0uNyAzLjUtMi4yIDQuN3MtMy4zIDEuNy01LjYgMS43Yy00LjIgMC03LjEtMi04LjMtNS4yem0yNy41IDJjLTIuMS0yLjEtMy4yLTQuOS0zLjEtNy44IDAtMy4xIDEtNS43IDMuMS03LjhzNC43LTMuMiA3LjktMy4yYzEuOSAwIDMuNy41IDUuNCAxLjQgMS42LjkgMi45IDIuMiAzLjggMy43bC0xLjQuOGMtLjctMS4zLTEuOC0yLjQtMy4xLTMuMi0xLjQtLjgtMy0xLjItNC42LTEuMi0yLjggMC01IC45LTYuOCAyLjdzLTIuNyA0LjItMi42IDYuN2MtLjEgMi41LjkgNC45IDIuNiA2LjcgMS44IDEuOCA0LjEgMi43IDYuOCAyLjcgMy4zIDAgNi4zLTEuOCA3LjctNC41bDEuNC44Yy0xLjcgMy4yLTUuMyA1LjItOS4yIDUuMi0zLjIuMi01LjgtLjktNy45LTN6TTE1My43IDExaDEuNnYyMS4zaC0xLjZWMjIuMWgtMTIuNHYxMC4yaC0xLjZWMTFoMS42djkuNmgxMi40VjExem0yMC41IDIxLjMtMi4xLTUuNGgtMTAuN2wtMi4xIDUuNGgtMS43bDguMy0yMS4zaDEuN2w4LjIgMjEuM2gtMS42em0tMTIuMS02LjloOS41TDE2Ni44IDEzbC00LjcgMTIuNHpNMTc4LjMgMTFoMS42djIxLjNoLTEuNlYxMXptMjAuMSAwaDEuNnYyMS4zaC0xLjRMMTg2IDE0djE4LjNoLTEuNlYxMWgxLjRsMTIuNiAxOC4zVjExeiIgc3R5bGU9ImZpbGw6I2ZmZiIvPjxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMV8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNTcuOTEzIiB5MT0iMTc5LjI3MiIgeDI9Ijk4LjY1NSIgeTI9IjIyMC4wMjQiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtNTUuNzYpIHNjYWxlKC4zMDk3KSI+PHN0b3Agb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjojMzY1ZmM4Ii8+PHN0b3Agb2Zmc2V0PSIuMDUiIHN0eWxlPSJzdG9wLWNvbG9yOiMzMzY4Y2EiLz48c3RvcCBvZmZzZXQ9Ii4zNyIgc3R5bGU9InN0b3AtY29sb3I6IzIyOWVkNCIvPjxzdG9wIG9mZnNldD0iLjY1IiBzdHlsZT0ic3RvcC1jb2xvcjojMTVjNmRjIi8+PHN0b3Agb2Zmc2V0PSIuODciIHN0eWxlPSJzdG9wLWNvbG9yOiMwZGRlZTAiLz48c3RvcCBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiMwYWU3ZTIiLz48L2xpbmVhckdyYWRpZW50PjxwYXRoIGQ9Im0xNCAzLjcgNi4yIDYuMmMuOS0uOSAyLjQtLjkgMy4zIDBzLjkgMi40IDAgMy4zYzIuNS0yLjQgNS45LTMuNiA5LjQtMy4yQzMyLjEgNCAyNi40LS4zIDIwLjQuNSAxOCAuOCAxNS43IDEuOSAxNCAzLjd6IiBzdHlsZT0iZmlsbDp1cmwoI1NWR0lEXzFfKSIvPjxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfMl8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNzkuNzM2IiB5MT0iMzIwLjczIiB4Mj0iMzguOTg1IiB5Mj0iMjc5Ljk3OSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgwIC01NS43Nikgc2NhbGUoLjMwOTcpIj48c3RvcCBvZmZzZXQ9IjAiIHN0eWxlPSJzdG9wLWNvbG9yOiMzNjVmYzgiLz48c3RvcCBvZmZzZXQ9Ii4wNSIgc3R5bGU9InN0b3AtY29sb3I6IzMzNjhjYSIvPjxzdG9wIG9mZnNldD0iLjM3IiBzdHlsZT0ic3RvcC1jb2xvcjojMjI5ZWQ0Ii8+PHN0b3Agb2Zmc2V0PSIuNjUiIHN0eWxlPSJzdG9wLWNvbG9yOiMxNWM2ZGMiLz48c3RvcCBvZmZzZXQ9Ii44NyIgc3R5bGU9InN0b3AtY29sb3I6IzBkZGVlMCIvPjxzdG9wIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6IzBhZTdlMiIvPjwvbGluZWFyR3JhZGllbnQ+PHBhdGggZD0iTTE5LjEgMzMuNGMtLjktLjktLjktMi41IDAtMy40LTIuNCAyLjQtNS45IDMuNy05LjQgMy4zLjggNi4xIDYuNCAxMC4zIDEyLjUgOS41IDIuNC0uMyA0LjYtMS40IDYuMy0zLjJsLTYuMi02LjJjLS45LjktMi4zLjktMy4yIDB6IiBzdHlsZT0iZmlsbDp1cmwoI1NWR0lEXzJfKSIvPjxsaW5lYXJHcmFkaWVudCBpZD0iU1ZHSURfM18iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMjcuODQxIiB5MT0iMjA5LjE4MSIgeDI9IjEwOS4zOTEiIHkyPSIyOTAuNzMxIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDAgLTU1Ljc2KSBzY2FsZSguMzA5NykiPjxzdG9wIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6I2RlMDE2YSIvPjxzdG9wIG9mZnNldD0iLjE4IiBzdHlsZT0ic3RvcC1jb2xvcjojZDgwMTZhIi8+PHN0b3Agb2Zmc2V0PSIuNDEiIHN0eWxlPSJzdG9wLWNvbG9yOiNjODAyNmEiLz48c3RvcCBvZmZzZXQ9Ii42NiIgc3R5bGU9InN0b3AtY29sb3I6I2FkMDQ2OSIvPjxzdG9wIG9mZnNldD0iLjk0IiBzdHlsZT0ic3RvcC1jb2xvcjojODcwNjY4Ii8+PHN0b3Agb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojN2YwNzY4Ii8+PC9saW5lYXJHcmFkaWVudD48cGF0aCBkPSJNMzkuMiAxMy4yYy0xLjctMS43LTMuOS0yLjgtNi4zLTMuMi0zLjQtLjUtNi45LjctOS40IDMuMkwxMi44IDIzLjljLS45LjktMi40LjgtMy4zLS4xLS44LS45LS44LTIuMyAwLTMuMkwyMC4yIDkuOSAxNCAzLjcgMy4zIDE0LjRDLTEgMTguNy0xIDI1LjggMy4zIDMwLjFjMS43IDEuNyA0IDIuOCA2LjMgMy4yIDMuNC41IDYuOS0uNyA5LjQtMy4ybDEwLjctMTAuNy4yLS4yYzEtLjggMi41LS42IDMuMy40LjcuOS43IDIuMi0uMiAzLjFMMjIuMyAzMy40bDYuMiA2LjIgMTAuNy0xMC43YzQuNC00LjMgNC40LTExLjMgMC0xNS43eiIgc3R5bGU9ImZpbGw6dXJsKCNTVkdJRF8zXykiLz48L2c+PHRleHQgY2xhc3M9InNtYWxsIiB0cmFuc2Zvcm09InJvdGF0ZSg5MCAxMzIuNSAxNDIuNSkiIHN0eWxlPSJ0ZXh0LWFuY2hvcjpzdGFydCI+MjEyMzIxPC90ZXh0Pjx0ZXh0IGNsYXNzPSJzbWFsbCIgdHJhbnNmb3JtPSJyb3RhdGUoOTAgLTEwNy41IDM4Mi41KSIgc3R5bGU9InRleHQtYW5jaG9yOmVuZCI+MHhlY2RhODEyYTY3ZmY5ZWIwMjU3NzMyZDZhMzYxMDA4ODY0Mjc1ZmNjPC90ZXh0Pjx0ZXh0IGNsYXNzPSJ0aXRsZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjAsMTAwKSI+PHRzcGFuIGNsYXNzPSJzbWFsbCBhbHBoYSIgeD0iMCI+RnVuZDwvdHNwYW4+PHRzcGFuIGNsYXNzPSJsYXJnZSIgeD0iMCIgZHk9IjIwIj5VbmljZWY8L3RzcGFuPjwvdGV4dD48dGV4dCBjbGFzcz0idGl0bGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIwLDE1MCkiPjx0c3BhbiBjbGFzcz0ic21hbGwgYWxwaGEiIHg9IjAiPkZvY3VzPC90c3Bhbj48dHNwYW4gY2xhc3M9ImxhcmdlIiB4PSIwIiBkeT0iMjAiPldhcjwvdHNwYW4+PC90ZXh0Pjx0ZXh0IGNsYXNzPSJ0aXRsZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjAsMjAwKSI+PHRzcGFuIGNsYXNzPSJzbWFsbCBhbHBoYSIgeD0iMCI+U3VwcG9ydDwvdHNwYW4+PHRzcGFuIGNsYXNzPSJsYXJnZSIgeD0iMCIgZHk9IjIwIj4xMDAwPC90c3Bhbj48L3RleHQ+PHJlY3QgeD0iMjM1IiB5PSI0ODAiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxMCIgZmlsbD0iIzI3NWZjYyI+PC9yZWN0PjxyZWN0IHg9IjI1MCIgeT0iNDgwIiB3aWR0aD0iMTAiIGhlaWdodD0iMTAiIGZpbGw9IiNlY2RhODEiPjwvcmVjdD48L3N2Zz4="
    );
  });

  it("should construct SVG representation", async function () {
    const tokenSVG = await this.contract.toSVG(
      212321,
      ethers.constants.WeiPerEther.mul(1000),
      "0xEcdA812a67Ff9EB0257732D6a361008864275fCC",
      "Unicef",
      "War"
    );

    expect(tokenSVG).to.equal(
      '<svg width="290" height="500" viewBox="0 0 290 500" xmlns="http://www.w3.org/2000/svg"><style><![CDATA[text{font-family:Helvetica;font-weight:100}.alpha{opacity:0.5}.small{font-size:.8rem}.large{font-size:1.2rem}.title{fill:#fff}]]></style><path fill="#22225E" d="M0 0h290v500H0z"></path><path fill="#FFF" d="M270 1h19v498h-19z"></path><g transform="translate(16 16)"><path d="m52.7 27.5 3.6-2.1c.8 2.2 2.4 3.3 4.9 3.3 2.4 0 3.4-.9 3.4-2.3 0-.7-.4-1.4-1-1.7-.7-.4-1.9-.9-3.6-1.4-1.9-.6-3.1-1-4.4-2-1.3-.9-2-2.4-2-4.4s.7-3.5 2-4.6c1.4-1.1 3.2-1.8 5-1.7 3.4 0 6.1 1.8 7.6 4.8l-3.5 2c-.9-1.8-2.2-2.7-4.1-2.7-1.7 0-2.8.9-2.8 2.1 0 .7.3 1.3.8 1.6.6.4 1.6.9 3.2 1.3l1.5.5c.5.2.9.3 1.4.5s.9.4 1.3.7c.7.4 1.6 1.1 2 1.9.5.9.8 2 .8 3 0 2-.7 3.5-2.2 4.7-1.4 1.1-3.3 1.7-5.6 1.7-4.2 0-7.1-2-8.3-5.2zm28 5.2c-6 .1-11-4.7-11.1-10.8v-.3c-.1-2.9 1.1-5.8 3.2-7.8 4.3-4.3 11.3-4.3 15.7 0 2.1 2 3.3 4.9 3.2 7.8.1 6-4.8 11-10.8 11.1-.1.1-.1.1-.2 0zm0-4.1c1.8.1 3.6-.7 4.9-2s2-3.1 2-5c.1-1.9-.7-3.7-2-5-2.7-2.6-7.1-2.6-9.8 0-1.3 1.3-2 3.1-2 5-.1 1.9.7 3.7 2 5 1.3 1.4 3 2.1 4.9 2zm11.4-1.1 3.6-2.1c.8 2.2 2.5 3.3 4.9 3.3s3.4-.9 3.4-2.3c0-.7-.4-1.4-1-1.7-.7-.4-1.9-.9-3.6-1.4-1.9-.6-3.1-1-4.4-2-1.3-.9-2-2.4-2-4.4s.7-3.5 2-4.6c1.4-1.1 3.2-1.8 5-1.7 3.4 0 6.1 1.8 7.6 4.8l-3.5 2c-.9-1.8-2.2-2.7-4.1-2.7-1.7 0-2.8.9-2.8 2.1 0 .7.3 1.3.8 1.6.6.4 1.6.9 3.2 1.3l1.5.5c.5.2.9.3 1.4.5s.9.4 1.3.7c.7.4 1.6 1.1 2 1.9.5.9.8 2 .8 3 0 2-.7 3.5-2.2 4.7s-3.3 1.7-5.6 1.7c-4.2 0-7.1-2-8.3-5.2zm27.5 2c-2.1-2.1-3.2-4.9-3.1-7.8 0-3.1 1-5.7 3.1-7.8s4.7-3.2 7.9-3.2c1.9 0 3.7.5 5.4 1.4 1.6.9 2.9 2.2 3.8 3.7l-1.4.8c-.7-1.3-1.8-2.4-3.1-3.2-1.4-.8-3-1.2-4.6-1.2-2.8 0-5 .9-6.8 2.7s-2.7 4.2-2.6 6.7c-.1 2.5.9 4.9 2.6 6.7 1.8 1.8 4.1 2.7 6.8 2.7 3.3 0 6.3-1.8 7.7-4.5l1.4.8c-1.7 3.2-5.3 5.2-9.2 5.2-3.2.2-5.8-.9-7.9-3zM153.7 11h1.6v21.3h-1.6V22.1h-12.4v10.2h-1.6V11h1.6v9.6h12.4V11zm20.5 21.3-2.1-5.4h-10.7l-2.1 5.4h-1.7l8.3-21.3h1.7l8.2 21.3h-1.6zm-12.1-6.9h9.5L166.8 13l-4.7 12.4zM178.3 11h1.6v21.3h-1.6V11zm20.1 0h1.6v21.3h-1.4L186 14v18.3h-1.6V11h1.4l12.6 18.3V11z" style="fill:#fff"/><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="57.913" y1="179.272" x2="98.655" y2="220.024" gradientTransform="translate(0 -55.76) scale(.3097)"><stop offset="0" style="stop-color:#365fc8"/><stop offset=".05" style="stop-color:#3368ca"/><stop offset=".37" style="stop-color:#229ed4"/><stop offset=".65" style="stop-color:#15c6dc"/><stop offset=".87" style="stop-color:#0ddee0"/><stop offset="1" style="stop-color:#0ae7e2"/></linearGradient><path d="m14 3.7 6.2 6.2c.9-.9 2.4-.9 3.3 0s.9 2.4 0 3.3c2.5-2.4 5.9-3.6 9.4-3.2C32.1 4 26.4-.3 20.4.5 18 .8 15.7 1.9 14 3.7z" style="fill:url(#SVGID_1_)"/><linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="79.736" y1="320.73" x2="38.985" y2="279.979" gradientTransform="translate(0 -55.76) scale(.3097)"><stop offset="0" style="stop-color:#365fc8"/><stop offset=".05" style="stop-color:#3368ca"/><stop offset=".37" style="stop-color:#229ed4"/><stop offset=".65" style="stop-color:#15c6dc"/><stop offset=".87" style="stop-color:#0ddee0"/><stop offset="1" style="stop-color:#0ae7e2"/></linearGradient><path d="M19.1 33.4c-.9-.9-.9-2.5 0-3.4-2.4 2.4-5.9 3.7-9.4 3.3.8 6.1 6.4 10.3 12.5 9.5 2.4-.3 4.6-1.4 6.3-3.2l-6.2-6.2c-.9.9-2.3.9-3.2 0z" style="fill:url(#SVGID_2_)"/><linearGradient id="SVGID_3_" gradientUnits="userSpaceOnUse" x1="27.841" y1="209.181" x2="109.391" y2="290.731" gradientTransform="translate(0 -55.76) scale(.3097)"><stop offset="0" style="stop-color:#de016a"/><stop offset=".18" style="stop-color:#d8016a"/><stop offset=".41" style="stop-color:#c8026a"/><stop offset=".66" style="stop-color:#ad0469"/><stop offset=".94" style="stop-color:#870668"/><stop offset="1" style="stop-color:#7f0768"/></linearGradient><path d="M39.2 13.2c-1.7-1.7-3.9-2.8-6.3-3.2-3.4-.5-6.9.7-9.4 3.2L12.8 23.9c-.9.9-2.4.8-3.3-.1-.8-.9-.8-2.3 0-3.2L20.2 9.9 14 3.7 3.3 14.4C-1 18.7-1 25.8 3.3 30.1c1.7 1.7 4 2.8 6.3 3.2 3.4.5 6.9-.7 9.4-3.2l10.7-10.7.2-.2c1-.8 2.5-.6 3.3.4.7.9.7 2.2-.2 3.1L22.3 33.4l6.2 6.2 10.7-10.7c4.4-4.3 4.4-11.3 0-15.7z" style="fill:url(#SVGID_3_)"/></g><text class="small" transform="rotate(90 132.5 142.5)" style="text-anchor:start">212321</text><text class="small" transform="rotate(90 -107.5 382.5)" style="text-anchor:end">0xecda812a67ff9eb0257732d6a361008864275fcc</text><text class="title" transform="translate(20,100)"><tspan class="small alpha" x="0">Fund</tspan><tspan class="large" x="0" dy="20">Unicef</tspan></text><text class="title" transform="translate(20,150)"><tspan class="small alpha" x="0">Focus</tspan><tspan class="large" x="0" dy="20">War</tspan></text><text class="title" transform="translate(20,200)"><tspan class="small alpha" x="0">Support</tspan><tspan class="large" x="0" dy="20">1000</tspan></text><rect x="235" y="480" width="10" height="10" fill="#275fcc"></rect><rect x="250" y="480" width="10" height="10" fill="#ecda81"></rect></svg>'
    );
  });
});
